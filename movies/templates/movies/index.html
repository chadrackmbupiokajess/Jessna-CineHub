{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessna Cin√©Hub</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

<header>
    <!-- √âl√©ments d√©coratifs pour l'animation -->
    <div class="decorative-bubble bubble-1"></div>
    <div class="decorative-bubble bubble-2"></div>

    <div class="header-content">
        <nav class="main-nav"> {# Ajout de la classe main-nav #}
            <a href="{% url 'index' %}" class="nav-link active">Accueil</a>
            <a href="{% url 'about' %}" class="nav-link">√Ä propos</a>
        </nav>
        <h1>Jessna Cin√©Hub</h1>
        <form method="get" action="{% url 'index' %}">
            <input type="text" name="query" placeholder="Rechercher un film..." value="{{ query }}">
            <button type="submit">Rechercher</button>
        </form>
    </div>
</header>

<main>
    {% if query and movies %}
        <h2 class="search-title">R√©sultats pour "{{ query }}"</h2>
    {% endif %}

    <div class="movies-grid" id="movies-grid">
        {# Le contenu initial est maintenant charg√© via un template partiel #}
        {% include "movies/partials/movie_cards.html" with movies=movies %}
    </div>

    {# Conteneur pour le spinner de chargement du d√©filement infini #}
    <div id="infinite-scroll-loader" class="loader-container" style="display: none;">
        <div class="loader-spinner"></div>
    </div>

</main>

<!-- Movie Details Overlay -->
<div id="movie-overlay" class="overlay">
    <div class="overlay-content">
        <span class="close-overlay" role="button" aria-label="Fermer">&times;</span>
        <img id="overlay-poster" src="" alt="Affiche du film">
        <div class="overlay-details">
            <h2 id="overlay-title"></h2>
            <p id="overlay-overview"></p>
            <div class="overlay-actions">
                <button id="overlay-trailer-btn" class="trailer-btn">üé¨ Voir la bande-annonce</button>
                <button class="quit-btn" data-close="movie-overlay">Quitter</button>
            </div>
        </div>
    </div>
</div>

<!-- Trailer Video Overlay -->
<div id="trailer-overlay" class="overlay">
    <div class="video-container">
        <span class="close-overlay" role="button" aria-label="Fermer">&times;</span>
        <div class="iframe-wrapper">
            <iframe id="trailer-iframe" 
                    src="" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    referrerpolicy="strict-origin-when-cross-origin" 
                    allowfullscreen>
            </iframe>
        </div>
        <div class="video-actions">
            <a id="youtube-watch-btn" href="#" class="youtube-btn" target="_blank" rel="noopener noreferrer">
                Voir sur YouTube
            </a>
            <button class="quit-btn" data-close="trailer-overlay">Fermer le lecteur</button>
        </div>
    </div>
</div>

{# On passe les donn√©es des films au JavaScript de mani√®re propre et s√©curis√©e. #}
{{ movies|json_script:"movies-data" }}

{# On passe aussi les informations de pagination au JavaScript #}
<script>
    window.paginationData = {
        currentPage: {{ current_page }},
        totalPages: {{ total_pages }},
        query: "{{ query|escapejs }}"
    };
</script>

<script src="{% static 'script.js' %}"></script>
</body>
</html>
